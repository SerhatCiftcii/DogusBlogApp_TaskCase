@model BlogViewModel
@using Microsoft.AspNetCore.Authorization

@{
    ViewData["Title"] = Model.Title;
}

<h1>@Model.Title</h1>
<p>@Model.Content</p>
<p>@Html.DisplayNameFor(model => model.PublishDate): @Model.PublishDate.ToShortDateString()</p>
<p>@Html.DisplayNameFor(model => model.CategoryName): @Model.CategoryName</p>
<p>@Html.DisplayNameFor(model => model.AuthorUsername): @Model.AuthorUsername</p>

<hr />

<div>
    <h4>Yorumlar</h4>
    @if (Model.Comments != null && Model.Comments.Any())
    {
        <ul>
            @foreach (var comment in Model.Comments.OrderByDescending(c => c.CreatedDate))
            {
                <li>
                    <strong>@comment.AuthorUsername:</strong> @comment.Text (@comment.CreatedDate.ToShortDateString())
                </li>
            }
        </ul>
    }
    else
    {
        <p>Henüz yorum yapılmamış.</p>
    }
</div>

<hr />

@if (User.Identity.IsAuthenticated)
{
    <h4>Yorum Ekle</h4>
    <form asp-controller="Blog" asp-action="AddComment" method="post">
        <div class="form-group">
            <label for="Text">@Html.DisplayNameFor(model => model.Comments.FirstOrDefault().Text):</label>
            <textarea class="form-control" id="Text" name="Text" rows="3" required></textarea>
        </div>
        <input type="hidden" name="BlogId" value="@Model.Id" />
        <button type="submit" class="btn btn-primary">Yorum Gönder</button>
    </form>
}
else
{
    <p>Yorum yapmak için <a asp-controller="Auth" asp-action="Login">giriş yapın</a>.</p>
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}